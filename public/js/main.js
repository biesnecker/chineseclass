(()=>{"use strict";const t=/[aeiouv]{1,2}/,e={a:0,o:1,e:2,i:3,u:4,v:5},n={a:["ā","á","ǎ","à"],e:["ē","é","ě","è"],o:["ō","ó","ǒ","ò"],u:["ū","ú","ǔ","ù"],i:["ī","í","ǐ","ì"],v:["ǖ","ǘ","ǚ","ǜ"]},o=["localhost","127.0.0.1",""].includes(window.location.hostname),a=t=>Math.floor(Math.random()*t),i=(t,e)=>{let n=0;0!=e.attempted&&(n=e.correct/e.attempted),t.innerHTML=`${e.correct} / ${e.attempted} (${(100*n).toFixed(2)}%)`};document.addEventListener("DOMContentLoaded",(()=>{const s={datatable:document.getElementById("datatable"),character:document.getElementById("character"),pinyin:document.getElementById("pinyin"),stats:document.getElementById("stats"),audio:document.getElementById("audiosource"),options:[document.getElementById("option_0"),document.getElementById("option_1"),document.getElementById("option_2"),document.getElementById("option_3")]};(["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document)&&datatable.classList.remove("use_hover");let r={correct:0,attempted:0},c=0,d=[];const l=Math.floor(Date.now()/1e3);fetch(`data.json?ts=${l}`).then((t=>t.json())).then((l=>{l.forEach((t=>d.push(t))),i(s.stats,r);let u=[];const m=Math.min(Math.max(Math.floor(d.length/2),1),20);let h=new Set,p=0;for(let t=0;t<m;++t)u.push(null);let f=0;const v=()=>{let i,r,c=!1;if(null!=u[p]){const t=u[p];h.delete(t),u[p]=null}for(;!c;){const t=a(d.length);h.has(t)||(i=d[t],u[p]=t,p+=1,p%=m,r=t,h.add(t),c=!0)}let l=new Set,v=0;for(c=!1;l.size<3;)v=a(d.length),v===r||l.has(v)||h.has(v)||l.add(v);var g;s.character.innerHTML=i.character,s.pinyin.innerHTML=(o=>o.trim().split(" ").map((o=>{const a=o.charAt(o.length-1),i=a>="0"&&a<="9"?parseInt(a,10):0;if(0===i)return o;const s=o.slice(0,-1);if(i<1||i>4)return s;const r=s.match(t);if(null===r)return o;const c=r[0];let d=0;if(1===c.length)d=r.index;else if("iu"===c||"ui"===c)d=r.index+1;else{let t=6,n=0;for(let o=0;o<c.length;++o){const a=e[c[o]];a<t&&(t=a,n=o)}d=r.index+n}const l=s.charAt(d);return s.substr(0,d)+n[l][i-1]+s.substr(d+1)})).join(" "))(i.pinyin),s.audio.setAttribute("src",(g=i.audio,o?`audio/${g}`:`https://d25j8baqrvaujh.cloudfront.net/${g}`)),s.audio.play();const y=l.values();f=a(4);for(let t=0;t<4;++t)s.options[t].innerHTML=t===f?i.definition:d[y.next().value].definition},g=t=>{t.preventDefault(),0===c&&s.audio.hasAttribute("src")&&s.audio.play()};[s.character,s.pinyin].forEach((t=>t.addEventListener("click",g))),s.options.forEach(((t,e)=>{return t.addEventListener("click",(n=e,t=>{if(t.preventDefault(),1===c)return;c=1,s.datatable.classList.add("answer_mode"),s.options[f].classList.add("correct"),r.attempted+=1;const e=n===f;e?r.correct+=1:s.options[n].classList.add("incorrect"),i(s.stats,r),setTimeout((()=>{c=0,s.datatable.classList.remove("answer_mode"),s.datatable.classList.add("normal_mode"),s.options[f].classList.remove("correct"),s.options[n].classList.remove("incorrect"),v()}),e?750:1500)}));var n})),v()}))}))})();
//# sourceMappingURL=main.js.map